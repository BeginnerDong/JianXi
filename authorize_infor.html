<!DOCTYPE html>
<html lang="en">
	<head id="header">
		<title>授权</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="baidu-site-verification" content="z8EeuYl0nS" />
		<meta name="keywords" content="简希">
		<meta name="description" content="简希">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
		<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
		<link href="css/basic.css" rel="stylesheet" />
		<link href="css/style.css" rel="stylesheet" />
		<script src="js/rem.js"></script>
		<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
		<script src="js/browser.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<script src="js/base.js" type="application/javascript"></script>
		<!-- <script src="js/jquery-3.3.1.min.js"></script> -->
		
		
	</head>
	<body>
		<style>
			.auth_tlt{
    width:100%;
    height:0.88rem;
    line-height:0.88rem;
    text-align: center;
  }
  .auth_cont{
    padding-bottom:0.3rem;
  }
  .input_list1{
    width:100%;
    height:.80rem;
    margin-top:.30rem;
    border-bottom:solid 1px #e0e0e0;
    }
    .input_list1 .input_before{
        width:22%;
    }
    .input_list1 input{
        width:76%;
        padding-left:2%;
        height:100%;
        border-radius:.16rem;
        border:none;
    }
    .input_list1 select{
        width:40%;
        margin-left:3%;
    }
    .submit_info{
        width:100%;
        height:0.8rem;
        line-height:0.8rem;
        border-radius:0;
        position:fixed;
        left:0;
        bottom:0;
		cursor:pointer
    }
</style>
		<div id="app">
			<div class="w750">
				<div class="w690">
					<div class="input_list1 font28 flex">
						<div class="input_before">您的姓名:</div>
						<input placeholder="请输入姓名" v-model="submitData.name"></input>
					</div>
					<div class="input_list1 font28 flex">
						<div class="input_before">设置密码:</div>
						<input placeholder="请输入密码" v-model="submitData.password" type="psssword"></input>
					</div>
					<div class="input_list1 font28 flex">
						<div class="input_before">联系电话:</div>
						<input placeholder="请输入联系电话" v-model="submitData.phone"></input>
					</div>
					<div class="input_list1 font28 flex">
						<div class="input_before">邮箱:</div>
						<input placeholder="请输入邮箱" v-model="submitData.email"></input>
					</div>
					<!-- <div class="input_list1 font28 flex">
						<div class="input_before">省市:</div>
						<input placeholder="请输入省市" v-model="submitData.province"></input>
					</div> -->
					<div class="input_list1 font28 flex">
						<div class="input_before">省市:</div>
						
						<div id="city01" class="flex" style="width:76%"> 
							<select class="prov" v-model="prov"></select>  
							<select class="city" disabled="disabled" ></select> 						
						</div>
					</div>
					<div class="input_list1 font28 flex">
						<div id="city"> 
							<select class="prov"></select>  
							<select class="city" disabled="disabled"></select> 
							<select class="dist" disabled="disabled"></select> 
						</div>
					</div>
					<div class="input_list1 font28 flex">
						<div class="input_before">代理级别:</div>
						<select v-model="submitData.level" id="level" name="level">
							<option  label="请选择" value='请选择'  selected="selected">请选择</option>
							<option label="联创" :value='1'>联创</option>
							<option label="品牌官方" :value='2'>品牌官方</option>
							<option label="大区主管" :value='3'>大区主管</option>
							<option label="经销商" :value='4'>经销商</option>
							<option label="VIP" :value='5'>VIP</option>
						</select>
					</div>
					<div class="input_list1 font28 flex">
						<div class="input_before">上级微信:</div>
						<input v-model="submitData.parent_wechat"></input>
					</div>
					<div class="input_list1 font28 flex">
						<div class="input_before">我的微信号:</div>
						<input v-model="submitData.wechat"></input>
					</div>
					<div class="input_list1 font28 flex">
						<div class="input_before">身份证号:</div>
						<input v-model="submitData.idCard"></input>
					</div>
					
					<form class="input_list1 font28 flex"  name="reg_testdate" >
						<div class="input_before">出生日期:</div>
						<div id="city_4" class="flex" style="width:76%">
							<select name="YYYY" onChange="YYYYDD(this.value)" v-model="year">
								 <option value="请选择 年" selected="selected" >选择 年</option>
								 </select>
							<select name="MM" onChange="MMDD(this.value)" v-model="month">
								 <option value="选择 月" selected="selected">选择 月</option>
								 </select>
							<select name="DD" v-model="day">
								 <option value="选择 日" selected="selected">选择 日</option>
							</select>
						</div>
					</form>
				</div>
				<div style="width:100%;height:0.8rem;position: absolute;bottom:-2rem;">
					<button class="submit_info" @click="submit" id="submit" style="width:60%;margin: 0 auto;position: static;border-radius:0.1rem">提交</button>
				</div>
			</div>
			
		</div>
		<script type="text/javascript" src="js/bootstrap.js"></script>
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/jquery.cityselect.js"></script>
		
		<script type="text/javascript">
			console.log('$("#city").citySelect',$("#city").citySelect)
			$(function(){
				$("#city").citySelect({
					nodata:"none",
					required:false
				}); 
			});
		</script>
		
		
		<script type="text/javascript ">
		

			function YYYYMMDDstart() {
				MonHead = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

				//先给年下拉框赋内容   
				var y = new Date().getFullYear();
				for (var i = (y - 29); i < (y); i++) //以今年为准，前118年，后30年   
					document.reg_testdate.YYYY.options.add(new Option(" " + i + " 年", i));

				//赋月份的下拉框   
				for (var i = 1; i < 13; i++)
					document.reg_testdate.MM.options.add(new Option(" " + i + " 月", i));

				//               document.reg_testdate.YYYY.value = y;   
				//               document.reg_testdate.MM.value = new Date().getMonth() + 1;   
				var n = MonHead[new Date().getMonth()];
				if (new Date().getMonth() == 1 && IsPinYear(YYYYvalue)) n++;
				writeDay(n); //赋日期下拉框Author:meizz   
				//              document.reg_testdate.DD.value = new Date().getDate();   
			}
			if (document.attachEvent) {
				window.attachEvent("onload", YYYYMMDDstart);
			} else {
				window.addEventListener('load', YYYYMMDDstart, false);
			}

			function YYYYDD(str) //年发生变化时日期发生变化(主要是判断闰平年)   
			{
				console.log('document.reg_testdate',document.reg_testdate)
				var MMvalue = document.reg_testdate.MM.options[document.reg_testdate.MM.selectedIndex].value;
				if (MMvalue == "") {
					var e = document.reg_testdate.DD;
					optionsClear(e);
					return;
				}
				var n = MonHead[MMvalue - 1];
				if (MMvalue == 2 && IsPinYear(str)) n++;
				writeDay(n)
			}

			function MMDD(str) //月发生变化时日期联动   
			{
				var YYYYvalue = document.reg_testdate.YYYY.options[document.reg_testdate.YYYY.selectedIndex].value;
				if (YYYYvalue == "") {
					var e = document.reg_testdate.DD;
					optionsClear(e);
					return;
				}
				var n = MonHead[str - 1];
				if (str == 2 && IsPinYear(YYYYvalue)) n++;
				writeDay(n)
			}

			function writeDay(n) //据条件写日期的下拉框   
			{
				var e = document.reg_testdate.DD;
				optionsClear(e);
				for (var i = 1; i < (n + 1); i++)
					e.options.add(new Option(" " + i + " 日", i));
			}

			function IsPinYear(year) //判断是否闰平年   
			{
				return (0 == year % 4 && (year % 100 != 0 || year % 400 == 0));
			}

			function optionsClear(e) {
				e.options.length = 1;
			}
		</script>

		<script type="text/babel">
			var app = new Vue({
				el: '#app',
				data: function() {
					return {
						submitData: {
							name: '',
							phone: '',
							email: '',
							province: '',
							level: '',
							wechat: '',
							parent_wechat: '',
							idCard: '',
							birth: '',
							password: '',
							openid:'',
						},
						prov: '',
						city: '',
						year:'',
						month:'',
						day:''
					}

				},
				mounted() {

				},
				computed: {

				},
				created: function() {
					var callback = (res)=>{
					  
					  this.userGet()
					  
					};
					window.base.getUserToken(callback);
				},
				
				methods: {
				
					
					userGet() {
						const self = this;
						const postData = {
							token: localStorage.getItem('user_token'),
							thirdapp_id: 2
						};
						const callback = (res) => {
							console.log('点这里',res)
							if (res.info.data.length > 0) {
								self.mainData = res.info.data[0];
								self.submitData.openid=self.mainData.openid
							} else {
								alert('数据错误')
							}
							
						}
						window.base.userGet(postData, callback);
					},




					register() {
						const self = this;
						const postData = window.base.cloneForm(self.submitData);
						postData.token = localStorage.getItem('user_token');
						postData.passage1 = localStorage.getItem('user_no');
						console.log('postData',postData)
						const callback = (data) => {
							if (data.solely_code == 100000) {
								alert('注册成功，等待审核')
	
								window.location.href = "./authorize_status.html";

							} else {
								alert(data.msg)
							};
						};
						window.base.register(postData, callback);
					},


					

					submit() {
						const self = this;
						var phone = self.submitData.phone;
						var idCard = self.submitData.idCard;
						var regIdNo = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
						
						
						self.submitData.province = self.prov + self.city;
						self.submitData.birth = self.year+'年'+self.month+'月'+self.day+'日'
					
						console.log(self.submitData)
						const pass = window.base.checkComplete(self.submitData);
						if (pass) {
							if(!self.year||!self.month||!self.day){
								alert('请补全生日')
								return
							}
							if(self.submitData.level==0){
								alert('请选择代理级别')
								return
							}
							if (!self.city) {
								alert('请选择市')
								return
							};
							if (!regIdNo.test(idCard)) {
								alert('身份证号填写有误');
								return;
							};
							if (phone.trim().length != 11 || !/^1[3|4|5|6|7|8|9]\d{9}$/.test(phone)) {
								alert('手机格式不正确')
							} else {
								self.register();
							}
						} else {
							alert('请补全信息');
						};
					},



				}

			});
		</script>
	</body>
</html>
